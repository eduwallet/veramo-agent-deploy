- name: Ensure Docker directory exists
  file:
    state: directory
    path: "{{ docker.dir }}"
    mode: 0755
  become: true

- name: Copy generic Dockerfile
  ansible.builtin.shell:
    cmd: "cp {{ configuration.dir }}/Dockerfile {{ docker.dir }}/issuer"
  become: yes

- name: Remove configuration
  ansible.builtin.shell:
    cmd: "rm -rf {{ docker.dir }}/issuer/conf"
  become: yes

- name: Copy configuration
  ansible.builtin.shell:
    cmd: "/usr/bin/cp -fr {{ configuration.dir }} {{ docker.dir }}/issuer/conf"
  become: yes

- name: Copy generic Dockerfile
  ansible.builtin.shell:
    cmd: "cp {{ configuration.dir }}/Dockerfile {{ docker.dir }}/verifier"
  become: yes

- name: Remove configuration
  ansible.builtin.shell:
    cmd: "rm -rf {{ docker.dir }}/verifier/conf"
  become: yes

- name: Copy configuration
  ansible.builtin.shell:
    cmd: "/usr/bin/cp -fr {{ configuration.dir }} {{ docker.dir }}/verifier/conf"
  become: yes

- name: Copy generic Dockerfile
  ansible.builtin.shell:
    cmd: "cp {{ configuration.dir }}/Dockerfile {{ docker.dir }}/statuslists"
  become: yes
  when: statuslists.enabled

- name: Remove configuration
  ansible.builtin.shell:
    cmd: "rm -rf {{ docker.dir }}/statuslists/conf"
  become: yes
  when: statuslists.enabled

- name: Copy configuration
  ansible.builtin.shell:
    cmd: "/usr/bin/cp -rf {{ configuration.dir }} {{ docker.dir }}/statuslists/conf"
  become: yes
  when: statuslists.enabled

- name: Copy generic Dockerfile
  ansible.builtin.shell:
    cmd: "cp {{ configuration.dir }}/Dockerfile {{ docker.dir }}/itb"
  become: yes
  when: itb.enabled

- name: Remove configuration
  ansible.builtin.shell:
    cmd: "rm -rf {{ docker.dir }}/itb/conf"
  become: yes
  when: itb.enabled

- name: Copy configuration
  ansible.builtin.shell:
    cmd: "/usr/bin/cp -fr {{ configuration.dir }} {{ docker.dir }}/itb/conf"
  become: yes
  when: itb.enabled

- name: Push Docker Env file
  template:
    src: docker.env.j2
    dest: "{{ docker.dir }}/.env"
  become: true

- name: Push Docker Compose configuration
  template:
    src: docker-compose.yml.j2
    dest: "{{ docker.dir }}/docker-compose.yml"
  become: true
